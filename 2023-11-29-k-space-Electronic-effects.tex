%---------------------- TEMPLATE FOR REPORT ------------------------------------------------------------------------------------------------------%

%\thispagestyle{fancy}   % 插入页眉页脚                                        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 用 authblk 包 支持作者和E-mail %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\title{More than one Author with different Affiliations}				     %
%\title{\rm{VASP}的电荷密度存储文件\rm{CHGCAR}}
%\title{面向高温合金材料设计的计算模拟软件中的几个主要问题}
\title{\textbf{高温合金材料的电子尺度模拟软件\\发展与创新研究}}
\author[ ]{姜~骏}   %
%\author[ ]{姜~骏\thanks{jiangjun@bcc.ac.cn}}   %
%\affil[ ]{北京市计算中心}    %
%\author[a]{Author A}									     %
%\author[a]{Author B}									     %
%\author[a]{Author C \thanks{Corresponding author: email@mail.com}}			     %
%%\author[a]{Author/通讯作者 C \thanks{Corresponding author: cores-email@mail.com}}     	     %
%\author[b]{Author D}									     %
%\author[b]{Author/作者 D}								     %
%\author[b]{Author E}									     %
%\affil[a]{Department of Computer Science, \LaTeX\ University}				     %
%\affil[b]{Department of Mechanical Engineering, \LaTeX\ University}			     %
%\affil[b]{作者单位-2}			    						     %
											     %
%%% 使用 \thanks 定义通讯作者								     %
											     %
\renewcommand*{\Authfont}{\small\rm} % 修改作者的字体与大小				     %
\renewcommand*{\Affilfont}{\small\it} % 修改机构名称的字体与大小			     %
\renewcommand\Authands{ and } % 去掉 and 前的逗号					     %
\renewcommand\Authands{ , } % 将 and 换成逗号					     %
\date{} % 去掉日期									     %
\date{2023-12-05}									     %

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  不使用 authblk 包制作标题  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%-------------------------------The Title of The Report-----------------------------------------%
%\title{报告标题:~}   %
%-----------------------------------------------------------------------------

%----------------------The Authors and the address of The Paper--------------------------------%
%\author{
%\small
%Author1, Author2, Author3\footnote{Communication author's E-mail} \\    %Authors' Names	       %
%\small
%(The Address，City Post code)						%Address	       %
%}
%\affil[$\dagger$]{清华大学~材料加工研究所~A213}
%\affil{清华大学~材料加工研究所~A213}
%\date{}					%if necessary					       %
%----------------------------------------------------------------------------------------------%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\maketitle
\thispagestyle{fancy}   % 首页插入页眉页脚 
\section{引言}
\ch{Ni}-基单晶高温合金是航空发动机核心部件的主要材料，其发展水平集中体现了一个国家的工业基础和科技水平，是综合国力的象征之一。进入廿一世纪以来，材料研发理念发生重大转变，伴随计算机和数据技术的发展，通过高通量计算(理论)/高通量实验(制备和表征)/专用数据库等关键技术的融合，新材料研发由“经验指导实验”的传统模式向“理论预测、实验验证”的新模式转变。但是对单晶高温合金材料，通过理论计算模拟材料的力学和热力学行为，仍然存在不小的困难:~除了单晶高温合金材料的组分复杂，模拟计算的建模困难、计算规模巨大之外，合金材料中存在大量含~\textit{d}-或~\textit{f}-电子的过渡金属元素，且元素的旋-轨耦合效应显著，这部分电子对材料物性的影响不能忽略，而电子效应的估计对计算精度的要求很高，所以单晶高温合金材料的微观模拟计算，既要适应复杂模型的计算规模，又要着重考虑电子效应的影响，因此必须在材料计算软件的计算能力和计算方法上作出创新。

\section{电子结构计算与$\vec k$空间表示}
材料的微观模拟中，原子核-电子作为理想的平移周期体系对待，周期分布的电子本征态表现为$\vec k$空间中的能带结构。能带既反映了材料中电子的能量分布特征，也包含了体系的对称性信息。对称性表明变换过程中物理量的守恒特征，充分利用对称性可在有限条件下获得更多的物理信息。高温合金材料的组分复杂，为合理反映微量元素的影响，设计的合金模型必须足够大，相应的计算规模远超过其它材料，这是高温合金模拟的主要困难之一。如何利用体系的晶体对称性，有效降低计算规模、提升模拟计算的能力，进而建立微观空间对称划分与宏观材料性质的关系，变得非常重要。之前的工作中，我们通过对高温合金的主要模拟软件\textrm{VASP}代码剖析，发现其对称性分析功能只有点群模块，缺少晶体空间群解析功能，因此软件对晶体的对称性利用不完全，我们从晶体学理论出发，按照点群-空间群生成对应法则，编写了全部空间群生成代码，完善了\textrm{VASP}软件的晶体空间对称性分析功能。空间群分析功能的引入，除了有助于高温合金材料模型的对称性判断，还可利用空间群的划分，明确多组元复杂模型微观空间结构与宏观力学特性的关系，简化高温合金材料的力学性质模拟。

材料的电子结构(能带)是通过电子的能量沿高对称方向的色散关系表示，习惯上表示能带的高对称性$\vec k$~点，没有统一的选取规则，完全出于研究者的偏好，因此同一材料的能带表示可能因为$\vec k$点选择的不同表现出很大的差别。%\textrm{Setyawan}等\upcite{CMS49-299_2010}以\textrm{BCC}结构的\ch{GeF4}的能带为例，指出
组分不同的单晶高温合金材料模型的电子结构表现出显著的相似性，选择规范、统一的$\vec k$点路径，不仅方便不同组分模型的电子结构数据对比，也为利用数据技术分析电子结构优化材料组分提供了统一的参考。根据晶体正空间和$\vec k$空间的对称性关联关系，我们开发了针对能带表示的高对称性$\vec k$~点路径标准化生成模块，并集成到\textrm{VASP}软件中，该模块的开发，不仅规范了软件的能带表示形式，也加深了我们对对称性分析功能的认识，为数据挖掘技术应用于高温合金材料的电子计算提供了必要的基础。

\section{电子特性对高温合金材料的影响}
合金元素的电子结构及它们的相互作用是确定合金的特性的微观基础，电子效应与高温合金的特性之间的关系是复杂而多层次的。合金中组成元素的电子成键行为，可能影响合金的整体电子结构，特别是部分填充的{\textit d}-或{\textit f}-轨道的过渡金属对合金的导电性、强度和磁性都有贡献。在高温合金中，电子效应除了对材料的电学、磁学性质有影响外，还可能对合金的相稳定性、氧化或蠕变的抵抗起到重要的作用，高温条件下，电子相互作用会甚至会影响合金结构的完整性，因此了解合金体系的电子效应对于调控性质以满足特定的工程要求至关重要。 

\subsection{\it{d}-电子与高温合金}
高温合金材料中，除了\ch{Al}元素外，含有大量的过渡金属元素(含有未成对\textit{d}-电子)，\textit{d}-电子的轨道形态丰富，根据高温合金的电荷密度分布不难看出，金属原子间的局域电荷密度的组分有明显的\textit{d}-电子的贡献，表明过渡金属间\textit{d}-电子有很明确的成键趋势，\textit{d}-电子参与成键的化学局域性好，有利于合金元素的稳定;~此外，过渡金属原子的\textit{d}-电子分布在\ch{Al}原子的周围，将有助于\ch{Al}与周围原子的稳定，因为\ch{Al}的\textit{p}-电子易于离域，一旦有过渡金属元素的\textit{d}-电子组分，形变能力和成键能力会明显提升，这将大大提升\ch{Al}原子的稳定性。通过高精度的第一原理计算，可以确定高温合金中的\textit{d}-电子对结构稳定能力提升的贡献。需要指出的是，由于\textit{d}-电子本身比较局域，电子相关(\textrm{electron correlation})效应显著，现有的\textrm{DFT}理论框架无法很精确地考虑复杂体系的\textrm{d}-电子相关效应。对高温合金的\textit{d}-电子效应的贡献，可能需要通过\textrm{DMFT}或\textrm{Green~function}等方法获得比较精确的电子相关估算。

\subsection{旋-轨耦合与高温合金}
功能材料中，当含有过渡金属为是重元素时，其价电子自旋与轨道角动量会发生显著的相互作用，对体系的物理性质有较显著的影响，这称为旋-轨耦合\textrm{(Spin-oribital coupling,~SOC)}效应(以价层及附近的\textit{p}-、\textit{d}-电子较为显著)。旋-轨耦合本质上是电子在原子核附近运动速度接近光速时，相对论效应不能忽略引起的。%对于轻元素，旋-轨耦合效应大约为$10^{-3}\sim10^{-2}\mathrm{eV}$，一般可以忽略。随着核电荷数的增加，旋-轨耦合的贡献将明显增加。
高温合金材料中的过渡金属合金组分多且复杂，旋-轨耦合效应在$10^{-2}\sim10^{-1}\mathrm{eV}$范围内，在考虑电子结构有关的性质时，一般不应忽略。%对于非功能材料，体系的热力学性质、力学性质主要取决于体系的原子-原子、分子-分子间相互作用，其大小范围在$1\sim10^3\mathrm{eV}$不等，比旋-轨耦合作用强得多，因此无须考虑旋-轨耦合效应的贡献。只有当旋-轨耦合效应大小与原子/分子间相互作用相当时，才需要考虑。只是精确估算旋-轨耦合效应时，计算成本将大大增加。所以对于高温合金材料，一个可行的方案是选择若干典型的模型，用标量相对论方法完成旋-轨耦合计算，估计体系中旋-轨耦合贡献的大小；将得到的数值与体系的原子/分子间相互作用势比较，如果两者数据接近，则旋-轨耦合效应不能忽略，否则在有关力学、热力学参数计算时，可暂时不予考虑。
旋-轨耦合的影响，主要影响体系的磁性行为和电子传输性质:~旋-轨耦合效应会引起对称性降低，可能导致能级的分裂，影响\textrm{Fermi}能级附近的电子状态，从而影响合金的电导率，另一方面，旋-轨耦合引入各向异性效应，意味着合金的某些性质可能随着材料中不同的取向变化，如合金的热电性质，磁晶各向异性等。

\section{\rm{VASP}软件的并行与计算性能的提升}
\textrm{VASP}作为材料模拟软件的代表，具有良好的材料物性计算模拟能力，有着出众的并行效率。\textrm{VASP}当前主要面向简单材料，对高温合金材料的软件模拟存在一定难度，必须在现有软件基础上发展和创新计算模式，才能完成对高温合金材料的有效模拟。通过分析\textrm{VASP}软件的并行与计算特色，可有针对性地考虑适应高温合金的计算模拟性能提升的策略。
%这里主要围绕核心计算软件\textrm{VASP}的并行能力和计算特点，从自动计算流程对核心计算软件的调度能力、自动流程软件与系统作业管理系统的交互能力几个方向发展相关方法，从整体上提高高通量材料计算自动流程处理复杂模型的尺度与规模。

\subsection{\rm{VASP}的计算特色和计算能力}
\textrm{VASP}软件是目前最流行的材料微观模拟软件之一，有着出色的并行能力。其计算特色主要包括:

(1)~物理思想层面，\textrm{VASP}采用的投影子缀加波\textrm{(PAW)}方法很好地平衡了计算的精度和效率，既保留了平面波-赝势方法的高效率，又包含了\textrm{LAPW}-全势方法的高精度计算思想，特别是针对含有大量\textit{d}-电子的高温合金体系，\textrm{PAW}从物理原理上保证了计算结果的可靠与高效。

(2)~\textrm{VASP}的离子-电子自洽迭代采用的是从头算分子动力学\textrm{AIMD}方法，通过在动力学系统中引入经典力学的绝热能量，实现电子与离子运动既可在同一动力学框架内处理，并在时间尺度上将两者分离。电子弛豫过程与分子动力学可以用类似迭代方式处理，不但大大简约了程序的复杂度，而且使得分子动力学与密度泛函理论紧密结合，无需诉诸跨尺度的势函数(力场)模拟。

(3)~算法层面上，\textrm{VASP}引入了大量的优化算法(如共轭梯度算法、\textrm{Davison}算法和\textrm{RMM-DIIS}算法等)，有效地保证了矩阵对角化和自洽迭代的快速收敛及稳定性问题。高温合金材料的设计更多的关注体系的热力学与结构性质，\textrm{VASP}的多层次优化算法支持的迭代收敛的特色，方便了高温合金材料的能量学数据的获得，为热力学与力学参数的计算提供了保障。

面向\ch{Ni}-基单晶高温合金这样的复杂体系模拟，必须从计算方法层面发展和提升软件对单晶高温合金的计算效率。除去软件已有的\textrm{AIMD}自洽迭代模式和\textrm{VASP}现有的共轭梯度、\textrm{RMM-DIIS}等经典的优化算法，有必要引入机器学习算法(如神经网络)在内的多种优化算法，实现复杂模型的自洽迭代快速稳定收敛。

\subsection{\rm{VASP}的并行规模和\rm{FFT}}
%核心计算软件是材料计算最重要的部分，所有的材料模拟和物性计算都要通过核心计算软件完成，
传统材料模拟主要依赖操作系统支持的\textrm{MPI}并行接口，完成大规模的自洽迭代和矩阵对角化，但这一模式的并行扩展性只能到数核-十数核，而且由于软件的\textrm{MPI}并行性能差异极大，扩展性也较差(一般不超过32核)。当组织多核完成复杂体系模拟时，常常造成计算资源的浪费。\textrm{VASP}的并行和扩展性都有突出的表现，一般的通用计算机上，\textrm{VASP}在64-128核能保持良好的的并行线性度。源于\textrm{VASP}在\textrm{MPI}并行的基础上，引入轮询调度算法\textrm{(Round-Robin Scheduling)}，实现计算任务在计算资源(节点或核)分配上的负载均衡。

电子结构模拟的自洽迭代求解偏微分方程\textrm{(Partial Differential Equations,~PDE)}是资源消耗的主要部分，\textrm{VASP}在\textrm{PDE}方程自洽迭代求解中应用优化算法(包括共轭梯度法、\textrm{RMM-DIIS}方法等)通过约束对角化矩阵的规模，限制节点间通信。保证了\textrm{MPI}并行的效率和扩展性。\textrm{VASP}的并行上限可以突破256核，但在500核数量级上，并行效率下降比较明显。如果对并行系统与\textrm{VASP}结合作深度改造(如国家超算天津中心的方案)，\textrm{VASP}的并行扩展可以到$10^4$核级别，这一改造需要对底层代码和计算框架作较大规模改动，一般科研工作者不具备这样的软件改写能力。

\textrm{VASP}的自洽迭代中，涉及电荷密度、势以及波函数计算过程存在大量的快速\textrm{Fourier}变换\textrm{(Fast Fourier Tranform,~FFT)}，这些\textrm{FFT}需要大量的内存开销，而且在软件并行部分所占比重很大，如果能从算法层面降低\textrm{FFT}的存储和通信，有助于进一步提升\textrm{VASP}的并行，提高软件处理合金模型的能力。%这方面有待进一步深入研究。
%由数据结构出发，构建支撑数据到计算资源的均衡负载的软件框架，将有望系统地提升材料计算核心软件的并行能力和扩展性，从而提升软件处理更大规模计算模型的能力。针对\ch{Ni}-基单晶高温合金材料的模拟，考虑到模型的复杂度(过渡金属原子多、原子成分变化大)，软件框架的开发将重点解决软件的并行扩展性问题，通过建立以密度矩阵理论为基础的线性标度算法及软件框架，原理性改变哈密顿矩阵结构，优化作业并行效率。

\subsection{提高计算流程的并发与均衡、计算资源的管理和调度能力}
当前的高通量材料计算自动流程软件大部分应用\textrm{Python}语言开发，有较好的灵活性，参照\textrm{VASP}软件的并行扩展度提高策略，通过重新设计计算流程，引入均衡负载算法，将可独立并发的计算任务根据计算资源均衡分配，提升计算流程的水平扩展\textrm{(Scale Out)}能力。

\begin{figure}[h!]
\centering
\vskip -2pt
\includegraphics[height=2.25in]{CH4_complex_machine.png}
\caption{面向复杂体系材料模拟顺序流程的子过程并发化示意图}%
\label{CH4_comp_BCC}
\end{figure}
%\subsection{改进计算流程对计算资源的管理和调度能力}
高通量材料计算流程软件\textrm{Material-Projects}的计算流程组织、管理和参数传递，都基于数据库实现，大大方便了复杂计算流程中的子任务的有序组装、分配。\ch{Ni}-基单晶高温合金材料的模拟流程流程，已远超现有自动流程软件的支持范围，复杂体系的材料模拟生成海量的初始结构，结构优化子过程的并发将有助于提升计算效率。利用数据库技术，针对单晶高温合金材料的计算模拟过程，开发新型自动流程软件，将每个子过程与传递参数都分解为数据库元素，组织并优化成并发度高的计算流程(如图\ref{CH4_comp_BCC}所示)，将会提升计算流程对计算资源的利用率，防止计算流程设计不合理引起的资源浪费，达到计算资源的合理、有效地调度和分配。 

\section{小结}
随着新材料研发理念的不断深入人心，在第四代\ch{Ni}-基单晶高温合金的研发过程中，材料模拟计算有望起到重要的牵引作用。应用现有材料计算软件支持如此复杂度材料的模拟，必须提升软件的计算规模和精度，保证计算资源的有效利用、管理和分配。通过剖析核心计算软件\textrm{VASP}的代码、发展相关功能，我们对\textrm{VASP}软件有比较深入的理解和认识，对高温合金材料含有过渡金属元素的\textit{d}-电子和旋-轨耦合效应对计算结果可能影响的讨论，我们提出%对和计算特点，提出了针对性的解决方案，重点围绕单晶高温合金材料计算模拟的复杂度，结合现有软件特点和计算方法的发展方向，提出主要
面向单晶高温合金体系模拟核心计算和流程软件发展的技术路线，包括\textrm{VASP}对称性功能模块的扩充、电子效应的计算、软件并行性能的提升和计算流程软件的合理设计。
