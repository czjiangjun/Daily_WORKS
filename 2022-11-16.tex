%---------------------- TEMPLATE FOR REPORT ------------------------------------------------------------------------------------------------------%

%\thispagestyle{fancy}   % 插入页眉页脚                                        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 用 authblk 包 支持作者和E-mail %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\title{More than one Author with different Affiliations}				     %
%\title{\rm{VASP}的电荷密度存储文件\rm{CHGCAR}}
%\title{面向高温合金材料设计的计算模拟软件中的几个主要问题}
\title{面向高温合金材料模拟的计算方法发展和创新研究}
\author[ ]{姜~骏}   %
%\author[ ]{姜~骏\thanks{jiangjun@bcc.ac.cn}}   %
%\affil[ ]{北京市计算中心}    %
%\author[a]{Author A}									     %
%\author[a]{Author B}									     %
%\author[a]{Author C \thanks{Corresponding author: email@mail.com}}			     %
%%\author[a]{Author/通讯作者 C \thanks{Corresponding author: cores-email@mail.com}}     	     %
%\author[b]{Author D}									     %
%\author[b]{Author/作者 D}								     %
%\author[b]{Author E}									     %
%\affil[a]{Department of Computer Science, \LaTeX\ University}				     %
%\affil[b]{Department of Mechanical Engineering, \LaTeX\ University}			     %
%\affil[b]{作者单位-2}			    						     %
											     %
%%% 使用 \thanks 定义通讯作者								     %
											     %
\renewcommand*{\Authfont}{\small\rm} % 修改作者的字体与大小				     %
\renewcommand*{\Affilfont}{\small\it} % 修改机构名称的字体与大小			     %
\renewcommand\Authands{ and } % 去掉 and 前的逗号					     %
\renewcommand\Authands{ , } % 将 and 换成逗号					     %
\date{} % 去掉日期									     %
%\date{2020-12-30}									     %

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  不使用 authblk 包制作标题  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%-------------------------------The Title of The Report-----------------------------------------%
%\title{报告标题:~}   %
%-----------------------------------------------------------------------------

%----------------------The Authors and the address of The Paper--------------------------------%
%\author{
%\small
%Author1, Author2, Author3\footnote{Communication author's E-mail} \\    %Authors' Names	       %
%\small
%(The Address，City Post code)						%Address	       %
%}
%\affil[$\dagger$]{清华大学~材料加工研究所~A213}
%\affil{清华大学~材料加工研究所~A213}
%\date{}					%if necessary					       %
%----------------------------------------------------------------------------------------------%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\maketitle
%\thispagestyle{fancy}   % 首页插入页眉页脚 
\section{引言}
作为航空发动机的核心部件的\ch{Ni}-基单晶高温合金，组分达到九元或更多且结构复杂，尽管近年来通用计算机的运算能力有了很大的提升，但是采用传统的简单金属材料模型方案，仍然难以模拟此类合金材料的力学和热力学行为，有必要从计算方法的角度考虑改善和创新对复杂合金的模拟方案。从计算物理的角度考虑，除了对单晶高温合金进行合理的建模外，针对单晶高温合金的计算方法层面的发展，还包括结构对称性分析方法的发展和创新，以及针对主要计算工具\textrm{VASP}软件在原子、电子层次计算的特点，在加速计算方面做必要的发展。此外，鉴于合金材料中有大量含有~\textit{d}-电子的金属元素，由于\textit{d}-电子的对称性复杂，大量的\textit{d}电子使得能带结构的复杂度显著增加;~在高精度计算中，合金中重元素的旋-轨耦合效应也将难以忽略，有必要从计算方法层次考虑计算这部分贡献对体系性能的影响。 在此基础上，我们才有望完整考虑单晶高温合金材料的电子能带结构及其与晶格的相互作用，确定材料的基本特性，进而研究材料在高温条件下产生的物理效应，揭示其物理机理的深刻内涵。

\section{对称性与能带路径的标准化}
对称性伴随的是系统在变换过程中物理量的守恒，利用对称性，能使我们在有限条件下获得更多的物理信息。材料学研究的理想模型一般都引入周期性边界条件(即满足平移对称性)，根据晶体学理论，平移对称性与点群对称性相互约束，将周期体系划分为32个点群和230个空间群。对于高温合金材料而言，因为组成元素及其组分比较复杂，为合理反映微量元素的影响，设计的合金模型必须足够大。相应的计算规模也将大大超过普通材料模拟，这是高温合金模拟的主要困难之一。这种情况下，如何利用体系的晶体对称性，有效地降低计算规模、提升模拟计算的能力，进而建立微观空间对称划分与宏观材料性质的关系，将是研究的一个重要问题。

在之前的工作中，通过对\textrm{VASP}软件的核心代码剖析，我们注意到\textrm{VASP}的对称性分析功能只有点群模块，缺少晶体空间群模块，对于周期体系计算和分析来说，这是该软件一个明显的缺陷。我们从晶体学理论出发，按照点群-空间群生成对应法则，编写了全部空间群生成代码，完善了\textrm{VASP}软件的晶体原子和空间对称性分析功能。空间群分析功能的引入，除了有助于高温合金材料模型的对称性判断，还可能利用空间群的划分，明确多组元复杂模型微观空间结构与宏观力学特性的关系，简化高温合金材料的力学性质模拟。

在微观层次上，材料的电子结构与体系的空间对称性同样密切关联。根据能带理论，具有平移对称性的周期体系，其电子结构都需要用能带表示。一般地，能带图给出的是体系中电子能量沿高对称方向的示意性质的能量分布。用于能带表征的高对称性沿线的代表性$\vec k$~点选择要求能够反映体系的空间对称性。软件模拟电子结构时，绘制能带图示所需的晶体高对称性$\vec k$~点方向的选择，主要依靠研究者的经验和习惯，并没有统一的规则，所以有着很大的随意性。%\textrm{Setyawan}等\upcite{CMS49-299_2010}以\textrm{BCC}结构的\ch{GeF4}的能带为例，指出
事实上如果选择$\vec k$~点路径时%中不包含\textrm{H}点，
高对称性点包含不完备，可能无法正确反映材料的电子的能量分布情况，使研究者%把间接带隙(\textrm{indirect gap})误指认为$\Gamma$点的直接带隙(如图\ref{Band_Gap_BCC_GeF4}所示)。
对材料的电子结构产生误判。对于有相同空间群的周期体系，选择相同的$\vec k$~点路径，将有助于电子结构和能带信息的比较。单晶高温合金材料的模拟，将会计算大量结构相似的合金模型的电子结构数据。确定合理的电子能带表示路径，不仅方便模型的电子结构数据对比，也将方便数据挖掘技术在能带领域的应用。为规范电子结构计算中能带的表示，文献\cite{CMS49-299_2010}建议了一套完整的$\vec k$~点路径($\vec k$-\textrm{path})选择方案。传统的\textrm{VASP}能带表示的$\vec k$~点路径完全依赖人工选择，因此我们开发的嵌入式功能模块，将上述能带表示的$\vec k$~点路径标准化模块集成到\textrm{VASP}软件中。对软件对称性分析模块功能的发展，将有助于针对高温合金材料的高通量模拟与分析，提升现有软件的计算能力，也为数据挖掘技术应用于高温合金材料的电子结构解析提供了必要的基础。

\section{\rm{VASP}软件的并行与计算性能的提升}
当前通用的高通量材料计算主要面向简单材料与模拟过程设计开发的。而高温合金材料的软件模拟中的迫切需求，现有的高通量材料计算软件(包括材料计算自动流程和核心材料模拟计算软件两个层次)很难提供有效支持，必须发展和创新现有的相关软件与算法，才能完成对高温合金材料的模拟。在\textrm{VASP}软件的并行与计算特色基础上，有针对性地考虑面向高温合金的计算模拟性能提升的策略:
\begin{itemize}
	\item \textrm{VASP}的并行规模和能力
	\item \textrm{VASP}的计算特色
	\item 提高计算流程软件的作业并发和负载均衡能力和对计算资源的管理和调度能力
\end{itemize}
这里主要围绕核心计算软件\textrm{VASP}的并行能力和计算特点，从自动计算流程对核心计算软件的调度能力、自动流程软件与系统作业管理系统的交互能力几个方向发展相关方法，从整体上提高高通量材料计算自动流程处理复杂模型的尺度与规模。

\subsection{\rm{VASP}的并行规模和\rm{FFT}}
%核心计算软件是材料计算最重要的部分，所有的材料模拟和物性计算都要通过核心计算软件完成，
\textrm{VASP}作为材料模拟软件的代表，具有良好的材料物性计算模拟能力，同时，与同类型软件相比也有着优异的并行效率。传统材料模拟处理复杂体系的策略主要依赖操作系统支持的\textrm{MPI}并行接口，完成大规模的自洽迭代和矩阵对角化，但这一模式的并行扩展性一般不高，只能到数核-十数核，而且由于软件的\textrm{MPI}并行性能差异极大，扩展性也较差(一般不超过32核)，当自动流程需要组织多个核心计算软件完成跨尺度计算时，有可能造成计算资源的巨大浪费。相比之下，\textrm{VASP}的并行和扩展性都有突出的表现，一般的通用计算机上，\textrm{VASP}在64-128核能保持良好的的并行线性度。根本原因是\textrm{VASP}软件在\textrm{MPI}并行的基础上，引入轮询调度算法\textrm{(Round-Robin Scheduling)}，实现计算任务在计算资源(节点或核)分配上的负载均衡。针对材料模拟计算过程中，自洽迭代求解偏微分方程\textrm{(Partial Differential Equations,~PDE)}是计算资源消耗的主要部分，\textrm{VASP}在\textrm{PDE}方程自洽迭代求解中应用优化算法(包括共轭梯度法、\textrm{RMM-DIIS}方法等)约束了对角化矩阵的规模，从而限制了矩阵对角化过程中的节点间通信。保证了\textrm{MPI}并行的规模和扩展性。在作业管理和效率高的计算队列中，\textrm{VASP}的并行上限可以突破256核，在百核数量级上，并行效率下降比较明显。如果对并行系统与\textrm{VASP}结合作深度改造(如国家超算天津中心的方案)，\textrm{VASP}的并行扩展可以到$10^4$核级别，但这一改造需要对底层代码和计算框架作较大规模改动，一般科研工作者不具备这样的软件改写能力。

另一方面，根据我们的测试，\textrm{VASP}的自洽迭代中，涉及电荷密度、势以及波函数处理部分必须完成大量的快速\textrm{Fourier}变换(\textrm{Fast Fourier Tranform}，这些\textrm{FFT}对并行效率的影响也比较大，会需要大量的内存开销，如果能从算法层面降低\textrm{FFT}的存储和通信，有助于进一步提升\textrm{VASP}的并行，从而提高现有\textrm{VASP}软件处理合金模型的能力。这方面有待我们做进一步的深入研究。
%由数据结构出发，构建支撑数据到计算资源的均衡负载的软件框架，将有望系统地提升材料计算核心软件的并行能力和扩展性，从而提升软件处理更大规模计算模型的能力。针对\ch{Ni}-基单晶高温合金材料的模拟，考虑到模型的复杂度(过渡金属原子多、原子成分变化大)，软件框架的开发将重点解决软件的并行扩展性问题，通过建立以密度矩阵理论为基础的线性标度算法及软件框架，原理性改变哈密顿矩阵结构，优化作业并行效率。

\subsection{\rm{VASP}的计算特色和计算能力提升策略}
\textrm{VASP}软件是目前最流行的材料微观模拟软件之一，其优异的并行能力使得其在众多材料微观模拟核心计算软件中脱颖而出。\textrm{VASP}软件的计算特色主要包括:

(1)~物理思想层面，\textrm{VASP}采用的投影子缀加波\textrm{(PAW)}方法很好地平衡了计算的精度和效率，既保留了平面波-赝势方法的高效率，又包含了\textrm{LAPW}-全势方法的高精度计算思想，特别是针对含有大量\textit{d}-电子的高温合金体系，\textrm{PAW}从物理原理上保证了计算结果的可靠与高效。

(2)~\textrm{VASP}的离子-电子自洽迭代采用的是从头算分子动力学\textrm{AIMD}方法，结合了密度泛函理论与经典分子动力学，通过在动力学系统中引入经典力学的绝热能量，实现电子与离子运动既可在同一动力学框架内处理，同时又在时间尺度上将两者分离。电子弛豫过程与分子动力学可以用类似迭代方式处理，不但大大简约了程序的复杂度，而且使得分子动力学与密度泛函理论可以紧密结合，无需诉诸跨尺度的势函数(力场)模拟。

(3)~算法层面上，\textrm{VASP}引入了大量的优化算法(如共轭梯度算法、\textrm{Davison}算法和\textrm{RMM-DIIS}算法等)，有效地保证了矩阵对角化和自洽迭代的快速收敛及稳定性问题。与普通的第一性原理计算侧重于电子结构计算不同，高温合金材料的设计更多的关注体系的热力学与结构性质，\textrm{VASP}的多层次优化算法支持的迭代收敛的特色，方便了高温合金材料的能量学数据的获得，为其热力学与力学参数的计算提供了保障。

不难看出，对于简单材料模拟，\textrm{VASP}软件的计算能力足以支持，但是对于\ch{Ni}-基单晶高温合金这样的复杂体系模拟，还需要从计算方法层面予以发展，提升软件对单晶高温合金的计算效率。单晶高温合金模拟主要的计算任务是\textrm{AIMD}自洽迭代计算，除了\textrm{VASP}现有的共轭梯度、\textrm{RMM-DIIS}等经典的优化算法，引入包括随机梯度下降优化算法和机器学习算法(如神经网络)在内的多种优化算法，实现复杂模型的自洽迭代快速稳定收敛。

\section{提高计算流程的并发与均衡、计算资源的管理和调度能力}
当前主要的高通量材料计算自动流程软件大部分应用\textrm{Python}语言开发，有较好的灵活性，但是简单的顺序式计算任务组织和作业提交模式也限制了流程软件的并发任务能力。参照\textrm{VASP}软件的并行扩展度提高策略，通过重新设计计算流程，引入均衡负载算法，将顺序计算流程中可独立并发的计算任务，按照计算资源实现均衡分配，提升计算流程的水平扩展\textrm{(Scale Out)}能力。当前的高通量材料计算流程软件中，\textrm{Mater Projects}的计算流程组织、管理和参数传递，都基于数据库实现，该模式大大方便了复杂计算流程中的子任务的有序组装、分配。\ch{Ni}-基单晶高温合金材料的模拟，涉及跨尺度计算的复杂流程，已经远远超过现有自动流程软件的支持范围，如图\ref{CH4_comp_BCC}所示，复杂体系的材料模拟生成海量的初始结构，结构优化子过程的并发将有助于提升计算效率。后续\textrm{DFT-MD}耦合计算中，也存在大量类似可并发的计算子过程(或组装的子过程)。利用数据库技术，针对单晶高温合金材料的计算模拟过程，开发新型自动流程软件，将每个子过程与传递参数都分解为数据库元素，组织并优化成并发度高的计算流程，将会提升计算流程对计算资源的利用率，克服因计算流程设计不合理而导致的资源浪费，最终实现合理、有效地调度和分配计算资源的目的。
\begin{figure}[h!]
\centering
\vskip -2pt
\includegraphics[height=2.25in]{CH4_complex_machine.png}
\caption{面向复杂体系材料模拟顺序流程的子过程并发化示意图}%
\label{CH4_comp_BCC}
\end{figure}
%\subsection{改进计算流程对计算资源的管理和调度能力}
高通量材料计算流程与作业管理系统都会涉及到对计算资源的调度、分配、管理，但现有的计算流程在生成计算任务后，将计算资源和任务提交作业管理系统后，直到作业管理系统完成计算任务管理过程，将结果和计算资源返还计算流程，这一过程中，计算流程一般不再参与计算资源的分配和调度。该模式在简单材料模型计算中可以保持较高的计算资源利用率，但是考虑到\ch{Ni}-基单晶高温合金材料的模拟计算流程的复杂性，即使考虑独立子进程的并发，计算过程中仍会存在诸多计算资源空置和等待的情形。以计算模型的结构优化为例，同时并发的多个计算模型，由于元素和组分的不同，并发任务完成时间的差别可能会很大。如果计算流程能在在此过程中动态地监控各计算资源上计算任务的负载情况，将后续队列中的计算任务及时地分发到空载节点上，有望加速计算模型的优化效率。在此基础上，如果适当引入数据挖掘或机器学习算法，也有助于提升材料模拟计算流程的计算速度。\textrm{Material Projects}所实现的数据库技术支持的计算流程管理，极大地方便计算流程的子过程和参数的分离，同时也为动态分发子过程提供了便利。对高温合金材料模拟的复杂计算流程，该技术可以支持新型材料复杂计算流程的开发，加强计算流程对计算资源的管理和调度，对于提升复杂材料模拟的高通量计算提供了重要的技术支持。

\section{\it{d}-电子与高温合金材料}
高温合金材料中，除了\ch{Al}元素外，含有大量的过渡金属元素(含有未成对\textit{d}-电子)，因此高温合金材料中将会存在大量的\textit{d}-电子。从形成化学键的角度说，过渡金属与非金属形成的化合物中，\textit{d}-电子因为主要局域在过渡金属原子周围，与非金属元素参与成键的贡献不大，\textit{d}-电子主要通过与近邻的\textit{p}-电子组合，增强\textit{p}-电子的空间形边，强化其与非金属价电子的作用；与普通化合物不同，金属合金中因为原子彼此都含有\textit{d}-电子，且原子距离足够小，因此金属合金中的\textit{d}-电子有更明确的彼此成键的趋势和能力。虽然\textit{d}-电子较局域，表观上不易成键，但因为\textit{d}-电子的轨道形态丰富，合金中的金属原子堆积紧密，因此合金中\textit{d}-电子间成键比金属原子-非金属原子的成键要容易得多。根据高温合金原子间电荷密度分布分析也不难看出，金属原子间的局域的电荷密度的组分，有明显的\textit{d}-电子的贡献，这表明过渡金属见的\textit{d}-电子有很明确的成键趋势，\textit{d}电子参与成键的化学局域性好，有利于合金元素的稳定;~此外，过渡金属原子的\textit{d}-电子分布在\ch{Al}原子的周围，将有助于\ch{Al}与周围原子的稳定，因为\ch{Al}的\textit{p}-电子易于离域，一旦有过渡金属元素的\textit{d}-电子组分，形变能力和成键能力会明显提升，这将大大提升\ch{Al}原子的稳定性。考虑到高温合金中的过渡元素种类丰富，而不同原子的\textit{d}-电子的含量各不相同，并且差别很大，因此要通过定量分析高温合金中的\textit{d}-电子的具体功能和作用，为后续高温合金材料的性能提升提供有参考价值的数据，必须对体系进行高精度的第一原理计算，解析\textit{d}-电子参与成键的结构信息。需要指出的是，由于\textit{d}-电子本身比较局域，电子相关(\textrm{electron correlation})效应显著，现有的\textrm{DFT}理论框架无法很精确地考虑类似高温合金这种复杂体系的\textrm{d}-电子相关效应。对高温合金的\textit{d}-电子效应的贡献，很可能需要通过\textrm{DMFT}或\textrm{Green~function}等方法获得比较精确的电子相关估算。

\section{旋-轨耦合与高温合金}
功能材料中，当含有过渡金属为是重元素时，其价电子自旋与轨道角动量会发生显著的相互作用，对体系的物理性质有较显著的影响，这称为旋-轨耦合\textrm{(SOC)}效应(以价层及附近的\textit{p}、\textit{d}电子较为显著)。旋-轨耦合本质上是当原子核很重，电子在原子核附近运动速度接近光速时，相对论效应不能忽略引起的。对于轻元素，旋-轨耦合效应大约为$10^{-3}\sim10^{-2}\mathrm{eV}$，一般可以忽略。但随着核电荷数的增加，旋-轨耦合的贡献将明显增加。高温合金材料中的过渡金属合金组分多且复杂，旋-轨耦合效应在$10^{-2}\sim10^{-1}\mathrm{eV}$范围内，在考虑电子结构有关的性质时，一般不应忽略。对于非功能材料，体系的热力学性质、力学性质主要取决于体系的原子-原子、分子-分子间相互作用，其大小范围在$1\sim10^3\mathrm{eV}$不等，比旋-轨耦合作用强得多，因此一般不考虑旋-轨耦合效应的贡献。只有当旋-轨耦合效应大小与原子/分子间相互作用相当时，才需要考虑。只是精确估算旋-轨耦合效应时，计算成本将大大增加。所以对于高温合金材料，一个可行的方案是选择若干典型的模型，用标量相对论方法完成旋-轨耦合计算，估计体系中旋-轨耦合贡献的大小；将得到的数值与体系的原子/分子间相互作用势比较，如果两者数据接近，则旋-轨耦合效应不能忽略，否则在有关力学、热力学参数计算时，可暂时不予考虑。

\section{小结}
材料模拟与计算在第四代\ch{Ni}-基单晶高温合金的研发过程中，将起到非常重要的探索和牵引作用，如何有效地管理、分配和利用计算资源，是应用高通量自动流程方式计算需要重点考虑的问题，现有的材料计算流程软件无法支持具有如此复杂度材料的高效模拟过程。通过剖析核心计算软件\textrm{VASP}的代码、发展相关功能，我们对\textrm{VASP}软件有了比较深入的掌握，我们讨论了\textrm{VASP}的对称性功能模块、并行性能和计算特点，从高温合金材料含有过渡金属元素的\textit{d}-电子和旋-轨耦合效应对计算结果可能的影响，提出了针对性的解决方案，重点围绕单晶高温合金材料计算模拟的复杂度，结合现有软件特点和计算方法的发展方向，提出主要面向单晶高温合金体系模拟核心计算和流程软件发展的技术路线。
